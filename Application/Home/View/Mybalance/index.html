<include file="./Application/Home/View/Layouts/header.html" />
<!-- 当前页面css -->
<link rel="stylesheet" type="text/css" href="/Application/Home/View/Mybalance/css/index.css">

	<!-- 内容主体start -->
	<div class="container mybalanceBox">
		<div class="col-md-3">
			<ul class="nav nav-tabs" role="tablist">
			    <li role="presentation" class="active"><a href="#mybalane" aria-controls="mybalane" role="tab" data-toggle="tab">我的余额</a></li>
				<if condition="$userType.type eq 1">
					<li role="presentation"><a href="#myincome" aria-controls="myincome" role="tab" data-toggle="tab">我的收入</a></li>
				</if>
			    <li role="presentation"><a href="#mycoupon" aria-controls="mycoupon" role="tab" data-toggle="tab">优惠券</a></li>
			</ul>
		</div>
		<div class="col-md-9">
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="mybalane">
					<p>我的余额：<span>{$userInfo1.balance}元</span><a href="__APP__/Recharge/index">充值</a></p>
					<div class="row">
						<div class="col-md-12 col-sm-12">
							<p class="balanceTitle">充值明细：</p>
						</div>
						<!-- 明细循环start -->

							<div class="col-md-12 col-sm-12">
								<div class="row" style="margin-bottom: 10px;">
									<!--<div class="col-md-12 col-sm-12">
										<p>2017-06-23</p>
									</div>-->
									<foreach name="chargeDetail" item="v">
									<div class="col-md-6 col-sm-6" style="margin-bottom: 10px;">
										<div class="content">
											<p style="margin: 0;">创建时间
												<svg class="icon categorie-icon" aria-hidden="true">
													<use xlink:href="#icon-shanchu"></use>
												</svg>
											</p>
											<p class="Stime">{$v.ctime|date='Y-m-d H:i:s',###}</p>
											<p class="rechargeMoney">充值金额：<b>￥{$v.money}</b></p>
											<p class="receipt">收款方：常州听娱软件科技有限公司</p>
										</div>
									</div>
									</foreach>
								</div>
								<!--<a class="moreList">加载更多</a>-->
							</div>

						<!-- 明细循环end -->
					</div>
				</div>
			    <div role="tabpanel" class="tab-pane" id="myincome">
					<p>我的收入：<span>{$userInfo.earning}元</span><a href="#" data-toggle="modal" data-target="#mywithdraw" >金额提现</a></p>
					<div class="row">
						<div class="col-md-12 col-sm-12">
							<p class="balanceTitle">收入明细：</p>
						</div>
						<!-- 明细循环start -->
						<div class="col-md-12 col-sm-12">
							<div class="row" style="margin-bottom: 10px;">

								<foreach name="arr" item="v">
									<div class="col-md-6 col-sm-6 coupouOne">
										<div class="content">
											<p>服务类型：{$v.cname}
												<svg class="icon categorie-icon" aria-hidden="true">
													<use xlink:href="#icon-shanchu"></use>
												</svg>
											</p>
											<p>开始时间：{$v.start_time|date='Y-m-d H:i',###}</p>
											<p>服务数量：{$v.charge_mode}</p>
											<!--<p>单价金额：{$v.bid_price}元</p>-->
											<p>支付金额：{$v.payment_amount}元</p>
											<div class="myincomeNum">
												<p>分成金额：</p>
												<p class="money">￥{$v.getMoney}</p>
											</div>
										</div>
									</div>
								</foreach>

							</div>
							<!--<div class="row" style="margin-bottom: 10px;">
								<div class="col-md-12 col-sm-12">
									<p>2017-06-23</p>
								</div>
								<div class="col-md-6 col-sm-6 coupouOne">
									<div class="content">
										<p>服务类型：恋爱指导
											<svg class="icon categorie-icon" aria-hidden="true">
								                <use xlink:href="#icon-shanchu"></use>
								            </svg>
										</p>
										<p>开始时间：2017-06-23 12:03</p>
										<p>服务数量：1小时</p>
										<p>单价金额：30.0元</p>
										<p>合计金额：30.0元</p>
										<div class="myincomeNum">
											<p>实收金额：</p>
											<p class="money">￥20.0</p>
										</div>
									</div>
								</div>
								<div class="col-md-6 col-sm-6 coupouOne">
									<div class="content">
										<p>服务类型：恋爱指导
											<svg class="icon categorie-icon" aria-hidden="true">
								                <use xlink:href="#icon-shanchu"></use>
								            </svg>
										</p>
										<p>开始时间：2017-06-23 12:03</p>
										<p>服务数量：1小时</p>
										<p>单价金额：30.0元</p>
										<p>合计金额：30.0元</p>
										<div class="myincomeNum">
											<p>实收金额：</p>
											<p class="money">￥20.0</p>
										</div>
									</div>
								</div>
							</div>-->
							<!--<a class="moreList">加载更多</a>-->
						</div>
						<!-- 明细循环end -->
					</div>
			    </div>
			    <div role="tabpanel" class="tab-pane" id="mycoupon">
					<div class="row">
						<div class="col-md-12 col-sm-12">
							<p class="balanceTitle">优惠券：</p>
						</div>
						<!-- 明细循环start -->
						<div class="col-md-12 col-sm-12">
							<div class="row" style="margin-bottom: 10px;">
								<div class="col-md-12 col-sm-12">
									<p></p>
								</div>
								<foreach name="allCoupon" item="v">
									<div class="col-md-6 col-sm-6">
											<div class="couponList">
												<div class="couponL">
													<span>￥{$v.price}</span>
												</div>
												<div class="couponC">
													<p class="couponCt">{$v.cname}</p>
													<p>{$v.explain}</p>
													<p class="couponCyou">有效期至{$v.end_time|date='Y-m-d H:i:s',###}</p>
												</div>
												<div class="couponR">
													<a href="__APP__/Index/index">立即使用</a>
												</div>
												<div style="clear: both;"></div>
											</div>
									</div>
								</foreach>
							</div>
							<!--<div class="row" style="margin-bottom: 10px;">
								<div class="col-md-12 col-sm-12">
									<p>2017-06-23</p>
								</div>
								<div class="col-md-6 col-sm-6 coupouOne">
									<div class="couponList">
										<div class="couponL">
											<span>￥50.0</span>
										</div>
										<div class="couponC">
											<p class="couponCt">新用户礼包</p>
											<p>新用户注册送50.0元新用户注册送50.0元</p>
											<p class="couponCyou">有效期至2017-07-01 00:00</p>
										</div>
										<div class="couponR">
											<a href="#">立即使用</a>
										</div>
										<div style="clear: both;"></div>
									</div>
								</div>
								<div class="col-md-6 col-sm-6 coupouOne">
									<div class="couponList">
										<div class="couponL">
											<span>￥50.0</span>
										</div>
										<div class="couponC">
											<p class="couponCt">新用户礼包</p>
											<p>新用户注册送50.0元新用户注册送50.0元</p>
											<p class="couponCyou">有效期至2017-07-01 00:00</p>
										</div>
										<div class="couponR">
											<a href="#">立即使用</a>
										</div>
										<div style="clear: both;"></div>
									</div>
								</div>
								<div class="col-md-6 col-sm-6 coupouOne">
									<div class="couponList">
										<div class="couponL">
											<span>￥50.0</span>
										</div>
										<div class="couponC">
											<p class="couponCt">新用户礼包</p>
											<p>新用户注册送50.0元新用户注册送50.0元</p>
											<p class="couponCyou">有效期至2017-07-01 00:00</p>
										</div>
										<div class="couponR">
											<a href="#">立即使用</a>
										</div>
										<div style="clear: both;"></div>
									</div>
								</div>
							</div>-->
							<!--<a class="moreList">加载更多</a>-->
						</div>
						<!-- 明细循环end -->
					</div>
			    </div>
			</div>
		</div>
	</div>
		<div class="modal fade mylogin" id="mywithdraw" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		  <div class="modal-dialog" role="document">
		    <div class="modal-content">
		      <div class="modal-header">
		      	<div class="row">
		      		<div class="col-sm-12">
				        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				        	<span aria-hidden="true">&times;</span>
				        </button>
			        </div>
		        </div>
		        <div class="modal-title" id="myModalLabel">
		        	<form class="form-horizontal" style="margin-top:20px;">
						<div class="form-group">
							<label for="inputPassword3" class="col-sm-3 control-label">当前收入</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" value="{$isWith.earning}" id="shouru" placeholder="" readonly>
							</div>
						</div>
					  <div class="form-group">
					    <label  class="col-sm-3 control-label">提现金额</label>
					    <div class="col-sm-9">
					      <input type="text" class="form-control" id="tixian" placeholder="请填写提现金额">
					    </div>
					  </div>

					  <div class="form-group">
					    <label  class="col-sm-3 control-label">支付宝</label>
					    <div class="col-sm-9">
					      <input type="text" class="form-control" value="{$isWith.alipay}" id="zhanghao" placeholder="首次填写账号后无法更改">
					    </div>
					  </div>
					  <div class="form-group">
					    <div class="col-sm-12 alipayBtn">
					      <button type="button" class="btn btn-default" id="sBt">确定</button>
					    </div>
					  </div>
					</form>
		        </div>
		      </div>
		    </div>
		  </div>
		</div>

	<!-- 内容主体end -->

<include file="./Application/Home/View/Layouts/footer.html" />
<!-- 当前页面js -->
<script type="text/javascript">
	$(function(){
		var bodycolorH=$(".bodyColor").height();
		var myselfH=bodycolorH-90-40-251;
		$(".mybalanceBox").css("min-height",myselfH+'px');
		$(".tab-content").css("min-height",myselfH-40+'px');
	})
</script>

<script>
	//点击提现确定

	$('#sBt').click(function(){

		var alipay=$('#zhanghao').val();//支付宝账号
		var needMoney=$('#tixian').val().replace(/\s/g, "");//提现金额
		var allMoney=$('#shouru').html();//当前收入
		var pattern=/[0-9]+(.[0-9]{1,3})?/g;//匹配到两位小数
		var money=allMoney.match(pattern);
		//转为浮点型数字
		var moneyFloat=parseFloat(money);
		var needFloat=parseFloat(needMoney);
		if(needMoney==''){
			 //alert('请输入提现金额');
			layer.open({
				title: '提现提示',
				content: '请输入提现金额'
			});
			//$.toast("请输入提现金额","text");
			return false;
		}
		if(needFloat==parseFloat(0)){
			 //alert('金额不能为0');
			layer.open({
				title: '提现提示',
				content: '金额不能为0'
			});
			//$.toast("金额不能为0","cancel");
			return false
		}
		if(alipay.replace(/\s/g, "")==''){
			//alert('填写支付宝账');
			layer.open({
				title: '提现提示',
				content: '填写支付宝账'
			});
			return false;
		}
		if(needFloat>moneyFloat){
			 //alert('提现金额不能大于当前收入');
			layer.open({
				title: '提现提示',
				content: '提现金额不能大于当前收入'
			});
			//$.toast("提现金额不能大于当前收入","cancel");
			return false;
		}else{
			$.ajax({
				url:'__APP__/Mybalance/getMoney',
				data:'money='+needFloat+'&applyNum='+alipay,
				dataType:'json',
				type:'post',
				success:function(re){
					if(re.info==1){
						 //alert(re.msg)
						/*layer.open({
							title: '提现提示',
							content: re.msg,
							time:2000
						});*/
						layer.alert(re.msg,function(){
							$('#shouru').html('￥'+re.myMoney)
							location.reload()
						})
						//$.toast(re.msg,"text");
						/*$('#shouru').html('￥'+re.myMoney)
						location.reload()*/
					}else if(re.info==4){
						 //alert(re.msg);
						//金额不能大于当前收入
						layer.alert(re.msg,function(){
							$('#shouru').html('￥'+re.myMoney)
							location.reload()
							//window.location.href='__APP__/Index/index'
						})
						//location.reload()
						//$.toast(re.msg,"text");
					}else if(re===false){
						// alert('提现失败');
						layer.open({
							title: '提现提示',
							content: '提现失败'
						});
						//$.toast("提现失败","cancel");
					}
				}
			})
		}

	})

	//判断是否为首次绑定支付宝账号
	if('{$isWith.alipay}'!==''){
		$('#zhanghao').attr('readonly','');
	}

</script>