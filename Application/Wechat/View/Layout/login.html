<link rel="stylesheet" type="text/css" href="/Application/Wechat/View/Layout/css/login.css">
<div class="row tanchu">
</div>

  <div class="col-sm-12 col-xs-12" id="myModal">
    <span class="shanchu">
      <svg class="icon categorie-icon" aria-hidden="true">
          <use xlink:href="#icon-shanchu" id="map"></use>
      </svg>
    </span>
    <div class="weui-tab">
      <div class="weui-navbar">
        <a class="weui-navbar__item weui-bar__item--on" href="#login">
          登录
        </a>
        <a class="weui-navbar__item" href="#signin">
          注册
        </a>
      </div>
      <div class="weui-tab__bd">
        <div id="login" class="weui-tab__bd-item weui-tab__bd-item--active">
            <form id="frm">
              <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                  <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
                  <div class="weui-cell__bd">
                    <input class="weui-input" id="phone"  type="number" name="username" pattern="[0-9]*" placeholder="请输入手机号">
                  </div>
                </div>
                <div class="weui-cell">
                  <div class="weui-cell__hd"><label class="weui-label">登录密码</label></div>
                  <div class="weui-cell__bd">
                    <input class="weui-input" id="pwd" type="password"  name="password" placeholder="请输入密码">
                  </div>
                </div>
              </div>
                <div class="col-sm-12 col-xs-12 loginBtn">
                  <a class="forgetPsw" id="forgetthe_psw">忘记密码？点击这里</a>
                  <a href="javascript:;" id="bt" class="weui-btn weui-btn_primary loginPsw">登录
                  </a>
                </div>
            </form>
        </div>
        <div id="signin" class="weui-tab__bd-item">
            <form>
              <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
              <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
              <div class="weui-cell__bd">
                <input class="weui-input" type="number" id="phone2" name="username" pattern="[0-9]*" placeholder="请输入手机号">
              </div>
            </div>
                <div class="weui-cell weui-cell_vcode">
              <div class="weui-cell__hd">
                <label class="weui-label">验证码</label>
              </div>
              <div class="weui-cell__bd">
                <input class="weui-input" type="tel" id="verify" name="verify" placeholder="请输入验证码">
              </div>
              <div class="weui-cell__ft">
                <a class="weui-vcode-btn" id="getverify">获取验证码</a>
              </div>
            </div>
                <div class="weui-cell">
              <div class="weui-cell__hd"><label class="weui-label">登录密码</label></div>
              <div class="weui-cell__bd">
                <input class="weui-input" id="pwd2" type="password"  placeholder="请输入密码">
              </div>
            </div>
                <div class="weui-cell">
                  <div class="weui-cell__hd"><label class="weui-label">确认密码</label></div>
                  <div class="weui-cell__bd">
                    <input class="weui-input" id="pwdcomfire" type="password"  placeholder="请输入确认密码">
                  </div>
                </div>
              </div>
              <div class="col-sm-12 col-xs-12 loginBtn">
            <a href="javascript:;" class="weui-btn weui-btn_primary" id="bt2">注册
            </a>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>


  <div class="col-sm-12 col-xs-12" id="forgetPsw">
    <span class="shanchu">
      <svg class="icon categorie-icon" aria-hidden="true">
          <use xlink:href="#icon-shanchu" id="map"></use>
      </svg>
    </span>
    <p class="resetPsw">重置密码</p>
    <form>
      <div class="weui-cells weui-cells_form">
        <div class="weui-cell">
          <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
          <div class="weui-cell__bd">
            <input class="weui-input" type="number" id="phone1" name="username" pattern="[0-9]*" placeholder="请输入手机号">
          </div>
        </div>
        <div class="weui-cell weui-cell_vcode">
          <div class="weui-cell__hd">
            <label class="weui-label">验证码</label>
          </div>
          <div class="weui-cell__bd">
            <input class="weui-input" type="tel" id="verify1" name="verify" placeholder="请输入验证码">
          </div>
          <div class="weui-cell__ft">
            <a class="weui-vcode-btn" id="getverify1">获取验证码</a>
          </div>
        </div>
        <div class="weui-cell">
          <div class="weui-cell__hd"><label class="weui-label">重置密码</label></div>
          <div class="weui-cell__bd">
            <input class="weui-input" id="pwd1" type="password"  placeholder="请输入新密码">
          </div>
        </div>
        <div class="weui-cell">
          <div class="weui-cell__hd"><label class="weui-label">确认密码</label></div>
          <div class="weui-cell__bd">
            <input class="weui-input" id="pwdcomfire1" type="password"  placeholder="请输入确认密码">
          </div>
        </div>
      </div>
      <div class="col-sm-12 col-xs-12 loginBtn">
        <a href="" data-dismiss="modal" aria-label="Close" class="weui-btn weui-btn_primary" data-toggle="modal" data-target="#myModal" id="bt1">确定
        </a>
      </div>
    </form>
  </div>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript">
    $(function(){
      //登录
      $('#bt').click(function(){
        var name=$('#phone').val();
        var pswd=$('#pwd').val();
        if(name.length>20 || name==''){
          // alert('输入正确手机号，不能为空')
          $.toast("输入正确手机号，不能为空", "cancel");
        }else if(pswd.length>20 || pswd==''){
          // alert('密码不能超过20位,不能为空')
          $.toast("密码不能超过20位,不能为空", "cancel");
        }else{
          $.ajax({
            url:'__APP__/Login/check',
            data:'username='+name+'&password='+pswd,
            dataType:'json',
            type:'post',
            success:function(re){
               if(re.info===4){
                // alert('该用户已被冻结，请联系网站负责人')
                $.toast("该用户已被冻结，请联系网站负责人", "cancel");
                window.location.href='__APP__/Login/index';
              }else if(re===false){
                // alert('用户名或密码错误');
                $.toast("用户名或密码错误", "cancel");
              }else if(re===true){
                window.location.href='__APP__/Index/index'
               }
            }
          })
        }
      })
      //注册
      $('#getverify').click(function(){
        var phone = document.getElementById('phone2').value;  //手机号码
        if(!(/^1[34578]\d{9}$/.test(phone))){
          // alert("手机号码有误，请重填");
          $.toast("手机号码有误，请重填", "cancel");
          return false;
        }
        $.ajax({
          url:'__APP__/Signin/getVerify',
          data:'phone='+phone,
          dataType:'json',
          type:'post',
          success:function(re){
            if(re===true){
              // alert('验证码发送成功,注意接收短信');
              $.toast("验证码发送成功,注意接收短信");
            }else if(re.info==3){
              $.toast(re.msg, "cancel");
            }else{
              // alert('验证码发送失败');
              $.toast("验证码发送失败", "cancel");
            }
          }
        })
      })
      function checkPhone(){ //验证手机号码正则函数  ，以及密码长度 ，确认密码是否一致
    var phone = document.getElementById('phone2').value;  //手机号码
    if(!(/^1[34578]\d{9}$/.test(phone))){
      // alert("手机号码有误，请重填");
      $.toast("手机号码有误，请重填", "cancel");
      return false;
    }
    //验证密码
    var pattern=new RegExp(/^(?![a-zA-z]+$)(?!\d+$)(?![!@#$%^&*]+$)[a-zA-Z\d!@#$%^&*]+$/);
    var pwd=$('#pwd2').val();                  //密码
    if(!pattern.test(pwd)){
      // alert('密码格式不正确，格式：字母+数字或者字符')
      $.toast("密码格式不正确，格式：字母+数字或者字符", "cancel");
      return false;
    }else if(pwd.length<6 || pwd.length>20){
      // alert('密码位数在6到20位之间');
      $.toast("密码位数在6到20位之间", "cancel");
      return false;
    }
    var conpwd=$('#pwdcomfire').val();
    if(pwd!==conpwd){
      // alert('两次密码不一致')
      $.toast("两次密码不一致", "cancel");
      return false;
    }
    return true;
  }

  $(function(){
    $('#bt2').click(function(){
      var phone = document.getElementById('phone2').value;  //手机号码
      var pwd=$('#pwd2').val();                  //密码
      var verify=$('#verify').val();
        if(checkPhone()){ //验证正确
          $.ajax({
              url:'__APP__/Signin/save',
              data:'username='+phone+'&password='+pwd+'&verify='+verify,
              dataType:'json',
              type:'post',
              success:function(re){
                if(re.info==2){  //短信验证码不正确
                  // alert(re.msg)
                  $.toast(re.msg, "cancel");
                }else if(re===true){
                  // alert('注册成功');
                  $.toast('注册成功');
                }else if(re.info==3){
                  // alert(re.msg);
                  $.toast(re.msg, "cancel");
                }
              }
          })
        }
    })
  })
      //忘记密码
      $('#getverify1').click(function(){
        var phone = document.getElementById('phone1').value;  //手机号码
        if(!(/^1[34578]\d{9}$/.test(phone))){
          // alert("手机号码有误，请重填");
          $.toast("手机号码有误，请重填", "cancel");
          return false;
        }

        $.ajax({
          url:'__APP__/Signin/getVerify',
          data:'phone='+phone+'&myOper=1',
          dataType:'json',
          type:'post',
          success:function(re){
            if(re===true){
              // alert('验证码发送成功,注意接收短信');
              $.toast("验证码发送成功,注意接收短信");
            }else if(re.info==3){
              $.toast(re.msg, "cancel");
            }else{
              // alert('验证码发送失败');
              $.toast("验证码发送失败", "cancel");
            }
          }
        })
      })
      function checkPhone1(){ //验证手机号码正则函数  ，以及密码长度 ，确认密码是否一致
    var phone = document.getElementById('phone1').value;  //手机号码
    if(!(/^1[34578]\d{9}$/.test(phone))){
      // alert("手机号码有误，请重填");
      $.toast("手机号码有误，请重填", "cancel");
      return false;
    }
    //验证密码
    var pattern=new RegExp(/^(?![a-zA-z]+$)(?!\d+$)(?![!@#$%^&*]+$)[a-zA-Z\d!@#$%^&*]+$/);
    var pwd=$('#pwd1').val();                  //密码
    if(!pattern.test(pwd)){
      // alert('密码格式不正确，格式：字母+数字或者字符')
      $.toast("密码格式不正确，格式：字母+数字或者字符", "cancel");
      return false;
    }else if(pwd.length<6 || pwd.length>20){
      // alert('密码位数在6到20位之间');
      $.toast("密码位数在6到20位之间", "cancel");
      return false;
    }
    var conpwd=$('#pwdcomfire1').val();
    if(pwd!==conpwd){
      // alert('两次密码不一致')
      $.toast("两次密码不一致", "cancel");
      return false;
    }
    return true;
  }

  $(function(){
    $('#bt1').click(function(){
      var phone = document.getElementById('phone1').value;  //手机号码
      var pwd=$('#pwd1').val();                  //密码
      var verify=$('#verify1').val();
      if(checkPhone1()){ //验证正确
        $.ajax({
          url:'__APP__/Signin/fsave',
          data:'username='+phone+'&password='+pwd+'&verify='+verify,
          dataType:'json',
          type:'post',
          success:function(re){
            if(re.info==2){  //短信验证码不正确
              // alert(re.msg)
              $.toast(re.msg, "cancel");
            }else if(re===true){
              // alert('注册成功');
              $.toast('修改成功');
            }
          }
        })
      }
    })
  })
  })
</script>